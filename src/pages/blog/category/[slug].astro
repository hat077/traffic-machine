---
import { getCollection } from 'astro:content';
import BaseHead from '../../../components/BaseHead.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';

// 1. Tell Astro what URLs to generate (e.g., /comparison, /pricing)
export async function getStaticPaths() {
	const posts = await getCollection('blog');
	
	// Get all unique categories from your posts
	const categories = [...new Set(posts.map((post) => post.data.category))];

	return categories.map((category) => {
		// Filter posts that belong to this category
		const filteredPosts = posts.filter((post) => post.data.category === category);
		
		return {
			// slug: the URL part (must be lowercase to match your links)
			params: { slug: category.toLowerCase() },
			// props: the data to pass to the HTML below
			props: { category, posts: filteredPosts },
		};
	});
}

// 2. Get the data for the current page
const { category, posts } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`${category} Guides`} description={`All our posts about ${category}`} />
		<style>
			main { width: 960px; max-width: calc(100% - 2em); margin: auto; padding: 3em 1em; }
			ul { list-style-type: none; padding: 0; }
			li { display: flex; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid #eee; padding-bottom: 2rem; }
			img { width: 200px; height: 120px; object-fit: cover; border-radius: 8px; margin-right: 2rem; }
			a { text-decoration: none; color: inherit; }
			h2 { margin: 0; font-size: 1.8rem; }
			.date { color: #888; font-size: 0.9rem; }
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Category: {category}</h1>
			<ul>
				{posts.map((post) => (
					<li>
						<a href={`/blog/${post.slug}/`}>
                            {/* This assumes you have images. If not, remove the img tag */}
							<img src={post.data.heroImage} alt="" />
						</a>
                        <div>
                            <div class="date">{post.data.pubDate.toLocaleDateString()}</div>
                            <a href={`/blog/${post.slug}/`}>
                                <h2>{post.data.title}</h2>
                            </a>
                            <p>{post.data.description}</p>
                        </div>
					</li>
				))}
			</ul>
		</main>
		<Footer />
	</body>
</html>